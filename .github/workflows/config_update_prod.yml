name: config_update_prod
on: 
  workflow_call:
    secrets:
      SSH_SERVER_HOST:
        required: true
      SSH_SERVER_PASSWORD:
        required: true
      SSH_SERVER_USERNAME:
        required: true
jobs:
  deployment:
    runs-on: 
      ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Copy files via SSH
        uses: appleboy/scp-action@v1
        with:
          host: ${{ secrets.SSH_SERVER_HOST }}
          username: ${{ secrets.SSH_SERVER_USERNAME }}
          password: ${{ secrets.SSH_SERVER_PASSWORD }}
          source: "infra/kubernetes"
          target: ~/app
      - name: update configuration via ssh
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.SSH_SERVER_HOST }}
          username: ${{ secrets.SSH_SERVER_USERNAME }}
          password: ${{ secrets.SSH_SERVER_PASSWORD }}
          script: kubectl apply -k ~/app/infra/kubernetes/overlays/prod
